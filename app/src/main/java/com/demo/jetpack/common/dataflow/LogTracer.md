# LogTracer.kt 文档

`LogTracer.kt` 文件提供了一个简单的日志追踪工具，用于在应用程序中生成唯一的请求 ID、测量代码块执行时间以及获取调用位置信息，从而方便调试和性能分析。

## `LogTracer` 对象

一个单例对象，包含日志追踪相关的常量和函数。

### 常量

*   `TAG`: 日志标签，固定为 `"CacheFirst"`。

### 函数

### `newId(): String`

*   **功能**: 生成一个唯一的请求 ID。
*   **描述**: 使用 `UUID.randomUUID()` 生成一个全局唯一标识符，并取其最后 8 位作为请求 ID。这个 ID 用于在日志中关联同一操作的不同日志条目，便于追踪请求的完整生命周期。

### `trace(requestId: String, block: () -> T): T`

*   **功能**: 测量代码块的执行时间，并记录详细的日志信息。
*   **参数**:
    *   `requestId`: 当前操作的唯一请求 ID。
    *   `block`: 一个无参数并返回 `T` 类型结果的 lambda 表达式，代表需要被追踪执行时间的代码块。
*   **描述**: 这是一个内联函数，它会在执行 `block` 代码块的前后记录时间戳，计算出代码块的执行耗时。然后，它会使用 `logD` 记录一条调试日志，包含请求 ID、当前线程名称、调用位置、执行耗时以及 `block` 的执行结果。
*   **性能测量**: 使用 `System.nanoTime()` 获取高精度的单调时间，确保时间测量不受系统时间调整的影响。

### `callerLocation(): String`

*   **功能**: 获取调用 `trace` 方法的代码位置信息。
*   **描述**: 通过遍历当前线程的堆栈跟踪（`Thread.currentThread().stackTrace`），查找第一个既不是 `trace` 也不是 `invoke` 的方法。这个方法被认为是实际的调用者。函数返回一个格式化的字符串，包含调用者的文件名、行号和方法名，例如 `"FileName.kt:123 (methodName)"`。这对于在日志中快速定位问题代码非常有用。
